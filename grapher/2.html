<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>F7 — Sheet push + 2 étapes (compact ↔ plein écran)</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/framework7@8.3.4/framework7-bundle.min.css" />

  <style>
    .demo-text{max-width:960px;margin:0 auto;}
    /* Requis/recommandé avec swipe-to-step */
    #sheet-demo{height:auto;}
    /* Empêche le step compact de mesurer 0px sur certains contextes */
    #sheet-demo .sheet-modal-swipe-step{min-height:100px;}

    /* Poignée (handle) visible et confortable au toucher */
    .swipe-handler{
      height:22px;display:flex;align-items:center;justify-content:center;cursor:ns-resize;
    }
    .swipe-handler::before{
      content:"";width:36px;height:4px;border-radius:2px;background:var(--f7-text-muted);opacity:.6;
    }
    /* Scroll propre + safe-area bas */
    .sheet-content{padding-bottom:calc(env(safe-area-inset-bottom,0)+12px);}
  </style>
</head>
<body>
  <div id="app">
    <div class="view view-main view-init ios-edges" data-url="/">
      <div class="page">
        <div class="navbar">
          <div class="navbar-bg"></div>
          <div class="navbar-inner"><div class="title">Démo Sheet — 2 steps</div></div>
        </div>
        <div class="page-content">
          <div class="block block-strong demo-text">
            <p><b>Page de démo</b> — la sheet est <b>toujours visible</b> en bas.</p>
            <p>Glisse le handle vers le haut pour le <b>plein écran</b> (push view), et vers le bas pour revenir au **compact**.</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit…</p>
          </div>
        </div>
      </div>
    </div>

    <!-- SHEET -->
    <div class="sheet-modal sheet-modal-push" id="sheet-demo">
      <div class="swipe-handler"></div>
      <div class="sheet-modal-inner">
        <!-- Zone visible à l’état compact -->
        <div class="sheet-modal-swipe-step">
          <div class="block no-margin">
            <p class="text-color-gray no-margin">État compact — toujours visible. Glisse pour agrandir ⤴︎</p>
            <div class="list inset">
              <ul>
                <li>
                  <div class="item-content">
                    <div class="item-inner">
                      <div class="item-title">Résumé A</div><div class="item-after">OK</div>
                    </div>
                  </div>
                </li>
                <li>
                  <div class="item-content">
                    <div class="item-inner">
                      <div class="item-title">Résumé B</div><div class="item-after">42</div>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Contenu révélé en plein écran -->
        <div class="block sheet-content">
          <p class="text-color-gray">Contenu plein écran</p>
          <p>Pellentesque at sapien urna. Vestibulum accumsan nibh non eleifend tristique…</p>
          <p>Curabitur nec risus justo. Integer vitae arcu non massa finibus faucibus…</p>
          <p>Morbi non neque nec lorem tincidunt convallis. Quisque ut commodo nulla…</p>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/framework7@8.3.4/framework7-bundle.min.js"></script>
  <script>
    const app = new Framework7({
      el:'#app',
      name:'DemoSheet2Steps',
      theme:'auto',
      sheet:{
        closeByBackdropClick:false,
        closeByOutsideClick:false,
      },
      on:{
        init(){
          // 1) Création sheet
          const sheet = app.sheet.create({
            el:'#sheet-demo',
            swipeToStep:true,            // 2 états (compact/plein écran)
            swipeToClose:false,          // interdit la fermeture complète
            swipeHandler:'.swipe-handler',
            push:true,                   // push view quand plein écran (effet plus marqué avec safe-area iOS/PWA)
            backdrop:true,               // backdrop en plein écran
          });

          // 2) Debug console (je veux que tu VOIS ce qui se passe)
          sheet.on('open', ()=>console.info('[sheet] open'));
          sheet.on('opened', ()=>console.info('[sheet] opened'));
          sheet.on('closed', ()=>console.info('[sheet] closed'));
          sheet.on('stepOpen', ()=>console.info('[sheet] stepOpen (plein écran)'));
          sheet.on('stepClose', ()=>console.info('[sheet] stepClose (compact)'));

          // 3) Ouverture + forcer l’état compact (visible)
          sheet.open(false);     // sans animation pour éviter le flash
          sheet.stepClose(false);

          // 4) Empêche toute fermeture (ESC/backdrop)
          sheet.on('close', ()=>{
            sheet.open(false);
            sheet.stepClose(false);
          });

          // 5) Sécurité: si le DOM ou CSS change et casse la hauteur, on recalibre
          requestAnimationFrame(()=>sheet.setSwipeStep());
          window.addEventListener('resize', ()=>sheet.setSwipeStep(), {passive:true});
        }
      }
    });
  </script>
</body>
</html>
