<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>F7 — Sheet push + full-sheet drag</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/framework7@8.3.4/framework7-bundle.min.css" />
  <style>
    /* requis pour swipe-to-step */
    #sheet { height: auto; }
    /* évite un compact à 0px */
    #sheet .sheet-modal-swipe-step { min-height: 84px; }
    /* handle visible (mais pas obligatoire pour drag) */
    .swipe-handler { height: 20px; display:flex; align-items:center; justify-content:center; }
    .swipe-handler::before { content:""; width:36px; height:4px; border-radius:2px; background:#999; opacity:.6; }
  </style>
</head>
<body>
<div id="app">
  <div class="view view-main view-init" data-url="/">
    <div class="page">
      <div class="navbar">
        <div class="navbar-bg"></div>
        <div class="navbar-inner">
          <div class="title">Sheet — push & full drag</div>
          <div class="right"><a href="#" class="link" id="open-link">Ouvrir</a></div>
        </div>
      </div>
      <div class="page-content">
        <div class="block">
          <p><a href="#" class="button button-fill" id="open-btn">Ouvrir la sheet</a></p>
          <p>Swipe n’importe où sur la sheet pour <b>déplier/replier</b>. L’effet <b>push view</b> est activé.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- NOTE: classe sheet-modal-push pour l'effet push -->
  <div class="sheet-modal sheet-modal-push" id="sheet">
    <div class="swipe-handler"></div>
    <div class="sheet-modal-inner">
      <!-- zone visible à l’état compact -->
      <div class="sheet-modal-swipe-step">
        <div class="block no-margin">
          <p class="no-margin text-color-gray">Compact — swipe/tap pour agrandir ⤴︎</p>
        </div>
      </div>
      <!-- contenu plein écran -->
      <div class="block">
        <p>Plein écran — swipe/tap pour replier ⤵︎</p>
        <p>Lorem ipsum dolor sit amet…</p>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/framework7@8.3.4/framework7-bundle.min.js"></script>
<script>
  const app = new Framework7({
    el: '#app',
    on: {
      init: function () {
        // Création de la sheet
        const sheet = this.sheet.create({
          el: '#sheet',
          swipeToStep: true,     // 2 étapes (compact ↔ plein écran)
          swipeToClose: false,   // jamais fermer complètement
          // IMPORTANT: pas de swipeHandler => drag sur TOUTE la sheet
          push: true,            // effet push view (avec la classe sheet-modal-push)
          backdrop: true
        });

        // Ouverte par défaut en compact (visible)
        sheet.open(false);
        sheet.stepClose(false);

        // Ouvrir via lien/bouton
        const open = (e)=>{ e && e.preventDefault(); sheet.open(); };
        document.getElementById('open-link').addEventListener('click', open);
        document.getElementById('open-btn').addEventListener('click', open);

        // Tap-to-toggle (pratique en plus du swipe)
        const sheetEl = document.getElementById('sheet');
        sheetEl.addEventListener('click', (e) => {
          // ignore le clic sur liens/boutons
          if (e.target.closest('a,button')) return;
          if (sheet.stepOpened) sheet.stepClose(); else sheet.stepOpen();
        });

        // Sécurité: recalibre après layout
        requestAnimationFrame(()=>sheet.setSwipeStep());
        window.addEventListener('resize', ()=>sheet.setSwipeStep(), { passive: true });
      }
    }
  });
</script>
</body>
</html>
